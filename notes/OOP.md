

ูุงุณ ูุชูุฑ ูุงูุฑุฉ ุฅู ุงูู Class ุญุงุฌุฉ "ุณุญุฑูุฉ" ูุฎุชููุฉ ุชูุงูุงู ุนู ุงูู Struct.

ุงูุญูููุฉ ุงูุตุงุฏูุฉ: ูู ุงูููููุฑูุ ูููุด ุฃู ูุฑู ุจูููู!

ุงูููุถูุน ุงูููุงุฑุฏุฉ ุนู: Object Memory Layout & The this Pointer.

ูุนูู ููุง ุจุชุนูู new Object()ุ ุฅูู ุงููู ุจูุชุฎุฒู ูู ุงูุฑุงูุงุชุ ููู ุงููุงููุดูุฒ ุจุชุชูุณุฎ ุฌูู ูู ุฃูุจุฌููุชุ

---

### 1. ุงูุตุฏูุฉ ุงูุฃููู: Class vs Struct ๐ค

ูู ูุบุงุช ุฒู C# ุฃู Javaุ ุงููุฑู ุจูููู ูุจูุฑ.

ูู C++ุ ุงููุฑู ุชุงูู ุฌุฏุงู ูุฏุฑุฌุฉ ุงูุถุญู:

- **Struct:**
- ูู ุญุงุฌุฉ ุฌูุงู **Public** (ูุชุงุญุฉ ูููู) ุฅูุง ูู ุฃูุช ููุช ุบูุฑ ูุฏู.
    
- **Class:** 
- ูู ุญุงุฌุฉ ุฌูุงู **Private** (ุณุฑูุฉ) ุฅูุง ูู ุฃูุช ููุช ุบูุฑ ูุฏู.
    

ุจุณ! ูู ุงูููููุฑูุ ุงูุงุชููู ูุงุญุฏ. ุงูุงุชููู ุจูุญุตููู Padding ู Alignment ุจููุณ ุงูุทุฑููุฉ ุงููู ุดุฑุญูุงูุง.



```C++
struct A { int x; }; // x is Public
class  B { int x; }; // x is Private
```

---

### 2. ุงูุตุฏูุฉ ุงูุซุงููุฉ: ุฃูู ุชุณูู ุงููุงููุดูุ ๐

ุชุฎูู ุฅูู ุนููุช ููุงุณ ููู 100 ูุงููุดูุ ูุนููุช ููู ููููู Object.

ูู ุงูุจุฑูุงูุฌ ุจุชุงุนู ููููุฌุฑ ูู ูุชุฑ ูุณุฎ ุงููุงููุดูุฒุ

ุงูุฅุฌุงุจุฉ: ูุฃ!

ุญุฌู ุงูุฃูุจุฌููุช ูุนุชูุฏ ุนูู ุงููุชุบูุฑุงุช (Data) ููุท. ุงููุงููุดูุฒ ูููุงุด ูุฒู.

- **ุงููุชุบูุฑุงุช (`int x, y`):** ูู ุฃูุจุฌููุช ููู ุงููุณุฎุฉ ุจุชุงุนุชู (ูู ุงูู Stack ุฃู Heap).
    
- **ุงููุงููุดูุฒ (`print()`):** ููุฌูุฏุฉ ูุฑุฉ ูุงุญุฏุฉ ุจุณ ูู "ูุทุงุน ุงูููุฏ" (Code Section / Text Segment).
    

**ูุซุงู ุงูุฅุซุจุงุช:**



```C++
#include <iostream>
using namespace std;

class Empty {
    // ููุงุณ ูุงุถู ูููููุด ุฏุงุชุง
public:
    void func1() { cout << "Hi"; }
    void func2() { cout << "Hello"; }
    void func3() { cout << "Bye"; }
};

class DataOnly {
public:
    int x; // 4 bytes
    int y; // 4 bytes
    void func() { cout << "Code"; } // 0 bytes in object
};

int main() {
    // ุงูููุงุฌุฃุฉ: ุงูููุงุณ ุงููุงุถู ุญุฌูู 1 ุจุงูุช (ูุด ุตูุฑ) ุนุดุงู ูุงุฒู ูููู ููู ุนููุงู ูู ุงูููููุฑู
    cout << "Size of Empty Class: " << sizeof(Empty) << endl; 

    // ููุง ุงูุญุฌู 8 ุจุงูุช (2 ints)
    // ุงููุงููุดูุฒ ูู ุชุฒุฏ ุจุงูุช ูุงุญุฏ ุนูู ุงูุญุฌู
    cout << "Size of Data Class:  " << sizeof(DataOnly) << endl;

    return 0;
}
```

---

### 3. ุงูุณุญุฑ ุงูุญูููู: The `this` Pointer ๐ช

ุทุงููุง ุงููุงููุดู ููุฌูุฏุฉ ูุฑุฉ ูุงุญุฏุฉ ุจุณ ูู ุงูููููุฑูุ ููุด ููุฌูุฏุฉ ุฌูู ุงูุฃูุจุฌููุช..

ุฅุฒุงู ููุง ุฃูุงุฏู obj1.print() ุจุชุทุจุน ุจูุงูุงุช obj1ุ ูููุง ุฃูุงุฏู obj2.print() ุจุชุทุจุน ุจูุงูุงุช obj2ุ

ุงูุฅุฌุงุจุฉ: **ุงูุจุงุฑุงููุชุฑ ุงููุฎูู (Hidden Parameter).**

ุงููููุจุงููุฑ ุจูุถุญู ุนููู. ููุง ุจุชูุชุจ ูุงููุดู ุฌูู ููุงุณุ ูู ุจูุฒูุฏ ุจุงุฑุงููุชุฑ ุฒูุงุฏุฉ ุงุณูู `this` ูู ูุฑุง ุถูุฑู.

**ุงููู ุฅูุช ุจุชูุชุจู:**



```C++
class Player {
    int health;
    void damage(int amount) {
        health -= amount; // ููู health ุฏูุ ุฏู ุจุชุงุนุฉ ุงูุฃูุจุฌููุช ุงููู ูุงุฏุงูู
    }
};

// ุงูุงุณุชุฏุนุงุก
p1.damage(10);
```

**ุงููู ุงููููุจุงููุฑ ุจูุดููู (ุงูุชุฑุฌูุฉ ุงูุญุฑููุฉ ูู C):**



```C++
struct Player { int health; };

// ุงููููุจุงููุฑ ุจูุญูููุง ููุงููุดู ุนุงุฏูุฉ ุจุชุงุฎุฏ ูุคุดุฑ
void Player_damage(Player* const this, int amount) {
    this->health -= amount; // ุจูุณุชุฎุฏู ุงููุคุดุฑ ุนุดุงู ููุตู ููููููุฑู ุงูุตุญ
}

// ุงูุงุณุชุฏุนุงุก ุจูุชุญูู ูู:
Player_damage(&p1, 10); // ุจูุจุนุช ุนููุงู p1 ูุฃูู ุจุงุฑุงููุชุฑ
```

> **ุงูุฎูุงุตุฉ:** ุงููุงููุดู ุนุงูุฉ ููุดุชุฑูุฉุ ุจุณ ุฅุญูุง ุจูุจุนุชููุง "ุนููุงู" ุงูุจูุงูุงุช ุงููู ุชุดุชุบู ุนูููุง ูู ูู ูุฑุฉ.

ูุนูู ุจุงูุจูุฏู ูุฏู ูุนุชุจุฑ ุงู ุณุทุฑ ุฏู `Player* const this` ูุนูุงู ุญุงุฌุฉ ุจุชุดุงูุฑ ุนูู ุญุงุฌู ูู ููุน player  ุงู ูุนูู ุจุชุดุงูุฑ ุนูู ููุณ ุงู ุนููุงู ููุฏู ูุนุชุจุฑ ุงู  this  ุฏู ุงุตูุง  alias ููู ุงูุจุฌูุช ---> ูู ุงูุจุฌูุช ุจูุชุนูู ูู ุงูููุงุณ ุจูุชุนููู  alias ุดุงูู ุนููุงูู ูุจูุชุจุนุช ูููุงููุดู ูุงู  alias  ุฏู ุงุณูู  this  .. ุชุฎูู ุจูู :)

---

### 4. ุงูู Static Members (ุงูููุจูุฐูู) ๐ฝ

ูู ุนุฑูุช ูุชุบูุฑ static ุฌูู ุงูููุงุณุ ุฏู ูุงุจูุจูุงุด ุฌูู ุงูุฃูุจุฌููุช ุฃุตูุงู.

ุฏู ุจูุชุฑูู ูู ููุทูุฉ ุงูู Global Dataุ ูุจูุจูู ูุดุชุฑู ุจูู ูู ุงููุณุฎ.



```C++
class Server {
    int connectionID; // ุฏู Instance Variable (ุฌูู ูู ุฃูุจุฌููุช) -> 4 ุจุงูุช
    static int activeUsers; // ุฏู Class Variable (ูุด ุฌูู ุงูุฃูุจุฌููุช) -> 0 ุจุงูุช ูู ุญุฌู ุงูุฃูุจุฌููุช
};

int main() {
    // ุญุฌู ุงูุฃูุจุฌููุช ูู ุญุฌู connectionID ุจุณ
    cout << "Size: " << sizeof(Server) << endl; // 4 bytes
}
```

ุงูู `static` ุฏู ุนุงูุด ุจุฑุงูู ุฎุงูุตุ ูููุฌูุฏ ุญุชู ูู ูุนููุชุด ููุง ุฃูุจุฌููุช.

---

### 5. ุณุคุงู ูููุญุชุฑููู (Next Level Teaser) ๐ฅ

ุฅุญูุง ุงุชูููุง ุฅู ุงููุงููุดูุฒ ูุงุจุชุงุฎุฏุด ูุณุงุญุฉ ูู ุงูุฃูุจุฌููุช.

ุจุณ ููู ุญุงูุฉ ุงุณุชุซูุงุฆูุฉ ูุญูุฏุฉ ุจุชุฎูู ุงูููุงุณ ูุฒูุฏ 8 ุจุงูุช (ูุคุดุฑ ุณุฑู) ุบุตุจ ุนููุ ุญุชู ูู ูููููุด ุฏุงุชุง.

ุงูุญุงูุฉ ุฏู ุจุชุญุตู ููุง ููุชุจ ูููุฉ `virtual` ูุจู ุงููุงููุดู.

**`virtual void print();`**

ุงููููุฉ ุฏู ุจุชุบูุฑ ุดูู ุงูููููุฑู ุชูุงูุงูุ ูุจุชูุชุญ ุจุงุจ ุงูู Polymorphism (ุชุนุฏุฏ ุงูุฃุดูุงู).

---


ุงูููุถูุน: **Virtual Method Table (vtable) & vptr**.

ุฅุญูุง ุงุชูููุง ุฅู ุงููุงููุดูุฒ ูุจุชุฃุฎุฏุด ูุณุงุญุฉ ุฌูู ุงูุฃูุจุฌููุช.

ุจุณ ูู ุญุทูุช ูููุฉ virtual ูุจู ุฃู ูุงููุดูุ ูุฌุฃุฉ ุญุฌู ุงูุฃูุจุฌููุช ุจูุฒูุฏ 8 ุจุงูุช (ูุคุดุฑ). ูููุ ูุฅูู ุงููู ุจูุญุตูุ

---

### 1. ุงููุดููุฉ: ุงููููุจุงููุฑ "ุงููุชุณุฑุน" (Static Binding) ๐โโ๏ธ

ุชุนุงูู ูุดูู ุงููููุจุงููุฑ ุจูููุฑ ุฅุฒุงู ูู ุบูุฑ `virtual`.



```C++
#include <iostream>
using namespace std;

class Parent {
public:
    void print() { cout << "I am Parent" << endl; }
};

class Child : public Parent {
public:
    void print() { cout << "I am Child" << endl; } // Overriding
};

int main() {
    // ูุคุดุฑ ูู ููุน ุงูุฃุจุ ุจูุดุงูุฑ ุนูู ุงุจู
    Parent* ptr = new Child(); 
    
    // ุงููููุจุงููุฑ ููุง "ุบุจู". ุจูุจุต ุนูู ููุน ุงููุคุดุฑ (Parent*)
    // ูุจูููู: "ุฃููุฏ ุฃูุช ุชูุตุฏ ุฏุงูุฉ ุงูุฃุจ"
    // ูุจูุฑุจุทูุง ููุช ุงูู Compilation (Static Binding)
    ptr->print(); 
    
    return 0;
}
```

**ุงููุชูุฌุฉ:** `I am Parent` (ุบูุท! ุฃูุง ุนุงูุฒ ุงูุงุจู).

---

### 2. ุงูุญู: ูููุฉ `virtual` (Dynamic Binding) ๐ข

ุนุดุงู ูุญู ุงููุดููุฉุ ุจูููู ูููููุจุงููุฑ: "ูุง ุนู ุงุชูู ุดููุฉุ ูุชูุฑุฑุด ูุชูุงุฏู ููู ุฏูููุชู.. ุงุณุชูู ููุง ุงูุจุฑูุงูุฌ ูุดุชุบู ูุดูู ุงูุฃูุจุฌููุช ุฏู ุฃุตูู ุฅูู".

C++

```C++
class Parent {
public:
    // ุงููููุฉ ุงูุณุญุฑูุฉ
    virtual void print() { cout << "I am Parent" << endl; }
};
```

ุงูุขู ุงููุชูุฌุฉ: `I am Child` (ุตุญ!).

ุงูุณุคุงู ุจูู: "ูู ุนุฑู ุฅุฒุงู ููุช ุงูุชุดุบูู ุฅู ุฏู Childุ" ๐ค

ููุง ูุธูุฑ ุฏูุฑ ุงูู Hidden Pointer.

---

### 1. ุชุฎูู ุงููุดูุฏ (ุงูููุซููู) ๐ฌ

1. **ุงููุคุดุฑ `ptr`:** ุฏู "ุงูุฒุจูู" ุงููู ูุนุงู ุนููุงู ุงูุจูุช (ุงูุฃูุจุฌููุช).
    
2. **ุงูุฃูุจุฌููุช (ูู ุงูู Heap):** ุฏู "ุงูุจูุช" ููุณู.
    
3. **ุงูู `vptr`:** ุฏู "ุงูุจูุงุจ" ุงููู ูุงุนุฏ ูู ูุฏุฎู ุงูุจูุช. ูุธููุชู ุงููุญูุฏุฉ: ูุฏูู **ุงูุฏูุชุฑ** ุงูุฎุงุต ุจุงูุจูุช ุฏู.
    
4. **ุงูู `vtable`:** ุฏู "ุงูุฏูุชุฑ" (ูุงุฆูุฉ ุฃุฑูุงู ุชูููููุงุช).
    
5. **ุงููุงููุดู (Code):** ุฏู "ุงูุดูุฉ" ุงููู ุฅุญูุง ุนุงูุฒูู ููุตููุง ูู ุงูุขุฎุฑ.
    

---

### 2. ุงูุฑุญูุฉ ุฎุทูุฉ ุจุฎุทูุฉ (The Journey) ๐ถโโ๏ธ

ุงูุณููุงุฑูู: ุฅูุช ูุชุจุช ูู ุงูู main:

ptr->print();

(ู ptr ุฏู ุจูุดุงูุฑ ุนูู ุฃูุจุฌููุช ูู ููุน Child).

**ุงูุฎุทูุฉ 1: ุงููุตูู ููุจูุช (Dereferencing)**

- ุงูููุจููุชุฑ ุจููุณู ุงูุนููุงู ุงููู ูู `ptr` ููุฑูุญ ููููุงู ุฏู ูู ุงูููููุฑู (Heap).
    
- ุฃูู ูุง ูุฏุฎู ุงูุจูุชุ ุจููุงูู ูู ูุดู ุนูุทูู "ุงูุจูุงุจ" (**vptr**). ุฏู ููุฌูุฏ ูู ุฃูู 8 ุจุงูุช ุบุตุจ ุนู ุฃู ุญุฏ.
    

**ุงูุฎุทูุฉ 2: ุณุคุงู ุงูุจูุงุจ (Fetch vptr)**

- ุงูููุจููุชุฑ ุจูุณุฃู ุงูุจูุงุจ: "ููู ุฏูุชุฑ ุงูุชูููููุงุช ุจุชุงุน ุงูุนููุฉ ุฏูุ".
    
- ุจูุง ุฅู ุงูุจูุช ุฏู ููุนู `Child`ุ ุงูุจูุงุจ (vptr) ููุฏูู ุนููุงู **"ุฏูุชุฑ ุนุงุฆูุฉ Child"** (`Child_vtable`).
    
    - _(ูู ูุงู ุงูุจูุช ุฏู ููุนู `Parent`ุ ุงูุจูุงุจ ูุงู ููุฏูู ุนููุงู "ุฏูุชุฑ ุนุงุฆูุฉ Parent")_.
        

**ุงูุฎุทูุฉ 3: ูุชุญ ุงูุฏูุชุฑ (vtable Lookup)**

- ุงูููุจููุชุฑ ุจูุฑูุญ ููุฏูุชุฑ ุฏู (ุงูุฌุฏูู).
    
- ุงููููุจุงููุฑ ูุงู ูุชูู ูุนุงู ูู ุจุฏุฑู: "ูุง ููุจููุชุฑุ ุฏุงูุฉ `print` ุฏุงููุงู ูุชูุงูููุง ูู **ุงูุณุทุฑ ุงูุฃูู** (Index 0) ูู ุฃู ุฏูุชุฑ".
    
- ูุงูููุจููุชุฑ ุจูุจุต ูู ุงูุณุทุฑ ุงูุฃูู ูู ุงูุฏูุชุฑ.
    

**ุงูุฎุทูุฉ 4: ุงูุนููุงู ุงูููุงุฆู (Dynamic Dispatch)**

- ุงูุณุทุฑ ุงูุฃูู ูู "ุฏูุชุฑ Child" ููุชูุจ ููู: **ุนููุงู ุฏุงูุฉ `Child::print`**.
    
- (ูู ููุง ูุชุญูุง ุฏูุชุฑ Parentุ ููุง ูููุงูู ููุชูุจ ููู ุนููุงู `Parent::print`).
    

**ุงูุฎุทูุฉ 5: ุงูููุฒ (Execute)**

- ุงูููุจููุชุฑ ุจูุงุฎุฏ ุงูุนููุงู ุฏูุ ูููุท ุนููู ูููุฐ ุงูููุฏ.
    

---

### 3. ุฑุณูุฉ ูุฑููู "ุจุงูุจูุฏู" โ๏ธ

Plaintext

```
1. ptr (ูุนุงูุง ุนููุงู 0x500)
    |
    V
2. Object at 0x500 (ุฏุฎููุง ุงูุจูุช)
   +----------------------+
   | vptr (ุงูุจูุงุจ)        | ----> ุจูุดุงูุฑ ุนูู: (ุฏูุชุฑ Child) 
   | int x                |              |
   | int y                |              |
   +----------------------+              |
                                         |
         +-------------------------------+
         |
         V
3. Child vtable (ุงูุฏูุชุฑ)
   +------------------------------------+
   | Index 0 (print)  | --> 0x999 (ุนููุงู ููุฏ Child::print)
   | Index 1 (attack) | --> 0x888 (ุนููุงู ููุฏ Child::attack)
   +------------------------------------+
                                |
                                V
                       4. Code Section (ุงูุดูุฉ)
                          [ cout << "I am Child" ]
```

---

### 4. ููู ุงูููุฉ ุงูุทูููุฉ ุฏูุ ๐ค

ุนุดุงู ุงููุฑููุฉ.

ุงูู ptr ููุนุฑูุด ูู ุจูุดุงูุฑ ุนูู ุฅูู ุจุงูุธุจุท (ูููู Childุ ููููู GrandChildุ ููููู Parent).

ูู "ุฃุนูู".

ูุงูุญู ุงููุญูุฏ ุฅูู ูุฑูุญ ูุฎุจุท ุนูู "ุงูุจูุช" ููุณูุ ูุงูุจูุช ูู ุงููู ููููู: "ุฃูุง ููุนู ูุฐุงุ ูุฏู ุนูุงูููู".

- ุงูุจูุช ุจูููู ููุนู ุนู ุทุฑูู ุงูู **vptr**.
    
- ูุงูุนูุงููู ููุฌูุฏุฉ ูู ุงูู **vtable**.
    



---

### 6. ููุฏ ูุซุจุช ุฒูุงุฏุฉ ุงูุญุฌู (ุงูุฏููู ุงููุงุทุน) โ๏ธ



```C++
#include <iostream>
using namespace std;

class NoVirtual {
public:
    int x;
    void show() { cout << "Hi"; }
};

class WithVirtual {
public:
    int x;
    virtual void show() { cout << "Hi"; } // ุงููููุฉ ุงููู ุจุชุฏูุนู 8 ุจุงูุช
};

int main() {
    // 4 ุจุงูุช (int) ุจุณ
    cout << "Size without virtual: " << sizeof(NoVirtual) << " bytes" << endl; 

    // 4 ุจุงูุช (int) + 4 ุจุงูุช (Padding) + 8 ุจุงูุช (vptr) = 16 ุจุงูุช!
    // (ุงูู Padding ุญุตู ุนุดุงู ุงูู vptr 8 ุจุงูุช ููุงุฒู ุงูู int ูุชุญุงุฐู ูุนุงู)
    cout << "Size with virtual:    " << sizeof(WithVirtual) << " bytes" << endl;

    return 0;
}
```

> [!NOTE] ููุญูุธุฉ ูููุฉ
> 
> ูููุง ุฒูุฏุช ุฏูุงู virtual ุฌูู ุงูููุงุณ (100 ุฏุงูุฉ ูุซูุงู)ุ ุญุฌู ุงูุฃูุจุฌููุช ูุด ููุฒูุฏ ุบูุฑ ุงูู 8 ุจุงูุช ุจุชูุน ุงููุคุดุฑ ุจุณ.
> 
> ุงููู ุจููุจุฑ ูู "ุงูุฌุฏูู" (vtable)ุ ูุฏู ููุฌูุฏ ูุฑุฉ ูุงุญุฏุฉ ููููุงุณ ูููุ ูุด ุฌูู ูู ุฃูุจุฌููุช.

---

### 7. ุงูุชูููุฉ (The Cost of Magic) ๐ธ

ูู ุงูู `virtual` ูุฌุงููุฉุ ูุฃ.

1. **Memory Overhead:** ุฒูุงุฏุฉ 8 ุจุงูุช ููู ุฃูุจุฌููุช (ุชูุฑู ูู ุนูุฏู ููุงููู ุงูุฃูุจุฌููุชุณ ุงูุตุบูุฑุฉ).
    
2. **Performance Overhead:** ุงุณุชุฏุนุงุก ุงูุฏุงูุฉ ุจูุงุฎุฏ ููุฉ ุฃุทูู (Pointer Dereference ูุฑุชูู) ุจุฏู ูุง ููุท ููููุฏ ุนูุทูู. ุฏู ุจูุฎูููุง ุฃุจุทุฃ ุณูุฉ ุตุบูุฑุฉุ ูุจูููุน ุงููููุจุงููุฑ ูู ุนูู Optimization ุงุณูู `Inlining`.
    

ุนุดุงู ูุฏุฉ ูู **Game Engines**ุ ุจูุญุงูููุง ูุชุฌูุจูุง ุงูู Virtual ูู ุงูุญุงุฌุงุช ุงููู ุจุชุชูุฑุฑ ูุชูุฑ ุฌุฏุงู (ุฒู ุงูู Particles ุฃู ุงูุฑุตุงุตุงุช)ุ ููู ุจูุณุชุฎุฏูููุง ูู ุงูุญุงุฌุงุช ุงููุจูุฑุฉ (ุฒู ุงููุงุนุจ ูุงููุญูุด).

---

